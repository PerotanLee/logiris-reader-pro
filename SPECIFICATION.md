# Logiris Reader - 詳細システム仕様書

## 1. 概要
「Logiris Reader」は、Bloombergのニュースレターを効率的かつストレスなく速読するために設計された、軽量なWebベースのニュースアグリゲーターです。Gmail APIと直接連携し、ユーザーの受信トレイから新鮮なニュースのみを抽出して、モバイルとデスクトップの両方で最適化された読書体験を提供します。

---

## 2. コア機能

### 2.1 データ取得とフィルタリング
- **検索クエリ**: `from:bloomberg.com is:unread newer_than:2d`
- **取得制限**: パフォーマンス維持のため、一度に取得・表示するメールを最大 **40件** に制限。
- **ソート順**: 時系列の文脈を把握しやすくするため、**古い順（Oldest First）** に並べて表示。
- **厳格な判定**: APIのクエリに加え、クライアント側でも `UNREAD` ラベルの有無を再確認し、既読メールの混入を防止。

### 2.2 アクション
- **一括既読機能**: 画面下の「Mark all X emails as read」ボタンにより、現在表示されているすべてのメールを一括で既読化（Gmail API `batchModify` を使用）。
- **個別既読機能**: 各メールカード内にある「Mark as Read」ボタンで個別に処理。

### 2.3 ナビゲーション
- **インスタントスクロール (FAB)**: 
  - 1タップで画面の **90%** を即座にスクロール。
  - スペースキー、PageDownキーにも対応。
- **ジャンプ機能**: ヘッダーのドロップダウンから特定のメールへ即座に移動。
- **プログレス表示**: 各メールに「位置/総数」（例: 1/40）を表示し、読書進捗を可視化。

---

## 3. ユーザーインターフェース (UI/UX)

### 3.1 デザインシステム
- **カラーパレット**: 
  - メイン背景: 深いネイビー (#0d1117 / GitHub Dark風)
  - アクセント: 鮮やかなブルー (#2f81f7) と深いネイビー (#163356)
  - テキスト: 高コントラストな白・グレー
- **タイポグラフィ**: 可読性の高い 'Inter' 系のサンセリフ体を使用。

### 3.2 モバイル最適化 (Galaxy Fold 7 等)
- **デバイス検知**: タッチ操作やUser Agentに基づき、モバイル版のレイアウト・挙動に自動切り替え。
- **可動式FAB (Draggable)**: 
  - モバイル環境のみ、スクロールボタンを上下に自由にドラッグして親指に最適な位置へ配置可能。
  - 初期位置は「機器の物理的な中央」を感じさせる画面右側 42% の位置。
  - 長押しによるブラウザメニューの誤作動を完全に抑制。
- **アダプティブ・ズーム**: 
  - モバイルでは標準で **1.5倍〜1.7倍** の自動ズームを適用。
  - ヘッダーのスライダーから手動での微調整も可能。

---

## 4. プログレッシブ・ウェブ・アプリ (PWA)

### 4.1 アプリ化対応
- **Standalone Mode**: ホーム画面に追加するとアドレスバーが消え、全画面の「アプリ」として起動。
- **テーマカラー**: システムのステータスバーを背景色 (#0d1117) と統合。

### 4.2 アイコン仕様
- **アイコンデザイン**: 選定された「案2（レンズのデザイン）」を採用。
- **角丸/マスク対応**: 
  - OS側（Android/iOS）で自由に丸型などにカットできるよう、背景が端まで白い「真白フルブリード」画像を使用。
  - 1024x1024px の高解像度アセットを配備。

---

## 5. 技術アーキテクチャ

### 5.1 フロントエンド
- **フレームワーク**: Vanilla JavaScript (ES6+), CSS3.
- **ビルドツール**: Vite.
- **ホスティング**: GitHub Pages (サブライブラリ `/logiris-reader-pro/` 下で動作).
- **パス解決**: サブフォルダ構成に対応するため、アセット（manifest, favicon等）はすべて **相対パス** で管理。

### 5.2 セキュリティと認証
- **OAuth 2.0**: Google Identity Services (GIS) を使用。
- **セッション維持**: 
  - アクセストークンを `localStorage` に保存。
  - リロード時、有効なトークンがあれば自動ログインを試行。
- **設定の永続化**: OAuth Client ID は初回入力時に `localStorage` に保存され、以降は入力不要。

### 5.3 自動翻訳と多言語対応
- **ネイティブ翻訳の誘発**: 
  - `index.html` の `lang` 属性をあえて `"en"` (英語) に設定。
  - これにより、ブラウザ側が「これは英語のコンテンツである」と正しく認識し、OS/ブラウザの設定に基づいた自動翻訳機能（Google翻訳等）が確実に発動するように設計。
- **PWAモードでの動作**: `standalone` モードを維持しつつ、上記の設定により「全画面表示かつ自動翻訳」の両立を実現。

### 5.4 堅牢性
- **動的スクリプト読み込み**: Google API (gapi) と Identity Services (gsi) をメインJSから順番にロード。静的なHTMLタグによるレースコンディション（読み込みエラー）を防止。
- **エラーハンドリング**: ネットワークエラー時に画面上に「再試行」ボタンを表示。
